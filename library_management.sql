CREATE DATABASE LIBRARY;
USE LIBRARY;

CREATE TABLE USERS(
USER_ID INT PRIMARY KEY,
USER_NAME VARCHAR(100) NOT NULL 
); 

CREATE TABLE BOOKS(
BOOK_ID INT PRIMARY KEY,
BOOK_NAME VARCHAR(200) NOT NULL  
); 

CREATE TABLE BORROWEDBOOKS(
USER_ID INT,
BOOK_ID INT,
FOREIGN KEY(USER_ID) REFERENCES USERS(USER_ID),
FOREIGN KEY(BOOK_ID) REFERENCES BOOKS(BOOK_ID)  
);

INSERT INTO USERS(USER_ID,USER_NAME) VALUES
(1,'SARA'),
(2,'SATZ'),
(3,'RAINA'); 

INSERT INTO BOOKS(BOOK_ID,BOOK_NAME) VALUES 
(1,'BOOK1'),
(2,'BOOK2'),
(3,'BOOK3'),
(4,'BOOK4'),
(5,'BOOK5'); 

INSERT INTO BORROWEDBOOKS(USER_ID,BOOK_ID) VALUES
(1,1),
(2,2), 
(3,3),
(3,1),
(2,5);

SELECT B.BOOK_NAME
FROM BOOKS B
JOIN BORROWEDBOOKS BB ON BB.BOOK_ID = B.BOOK_ID 
JOIN USERS U ON U.USER_ID = BB.USER_ID
WHERE U.USER_NAME = 'RAINA';  

SELECT U.USER_NAME 
FROM USERS U
JOIN BORROWEDBOOKS BB ON BB.USER_ID = U.USER_ID
JOIN BOOKS B ON BB.BOOK_ID = B. BOOK_ID
WHERE B.BOOK_NAME = 'BOOK1';

SELECT B.BOOK_NAME
FROM BOOKS B 
LEFT JOIN BORROWEDBOOKS BB ON BB.BOOK_ID = B.BOOK_ID
WHERE BB.USER_ID IS NULL;
 
SELECT U.USER_NAME , COUNT(BB.BOOK_ID) AS BOOKBORROWED
FROM USERS U 
LEFT JOIN BORROWEDBOOKS BB ON BB.USER_ID = U.USER_ID
GROUP BY U.USER_NAME;
 
 SELECT U.USER_NAME , COUNT(BB.BOOK_ID) AS BOOKSBORROWED
 FROM USERS u
 JOIN BORROWEDBOOKS BB ON U.USER_ID = BB.USER_ID
 GROUP BY U.USER_NAME
 HAVING COUNT(BB.BOOK_ID) = (
 SELECT MAX(BOOKSBORROWED)
 FROM(
 SELECT COUNT(BB.BOOK_ID) AS BOOKSBORROWED
 FROM BORROWEDBOOKS BB
 GROUP BY BB.USER_ID
 ) AS BORROWCOUNTS
 );

 